# 本地抽奖系统测试指南

## 问题分析
Vercel部署的后端返回500错误，网络连接不稳定。

## 解决方案：使用本地服务器

### 1. 启动本地服务器
```bash
# 在项目目录下运行
pnpm dev:server
```

### 2. 测试本地连接
```bash
# 新开一个终端窗口
node local-lottery-test.cjs
```

### 3. 使用交互式CLI
```bash
# 启动本地交互式抽奖工具
node lottery-cli.cjs
```

## 工具说明

### local-lottery-test.cjs
- **用途**: 测试本地服务器连接
- **特点**: 自动完成完整流程
- **依赖**: 需要本地服务器运行在 http://localhost:3001

### lottery-cli.cjs  
- **用途**: 交互式抽奖界面
- **功能**: 创建用户、抽奖、查看记录
- **依赖**: 需要本地服务器

### web-lottery-client.cjs
- **用途**: 完整的API客户端库
- **功能**: 可在其他项目中导入使用
- **依赖**: 需要本地服务器

## 常见问题

### 问题1: 连接本地服务器失败
```
❌ 本地服务器连接失败: ECONNREFUSED
```
**解决方案**: 
```bash
# 确保服务器正在运行
pnpm dev:server
```

### 问题2: 端口被占用
**解决方案**: 
```bash
# 修改server.cjs中的端口
const PORT = 3002; // 改为其他端口
```

### 问题3: 数据库连接问题
**解决方案**: 
```bash
# 检查Supabase配置
cat .env
```

## 网络版本修复
如果需要修复Vercel部署：
1. 检查Vercel函数日志
2. 确认环境变量配置
3. 验证Supabase连接
4. 重新部署应用

## 推荐流程
1. 使用本地服务器进行开发和测试
2. 确认功能正常后再部署到Vercel
3. 使用网络版本进行生产环境访问